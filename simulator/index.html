<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='UTF-8'>
    <meta name="google" content="notranslate">
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <script src='https://code.jquery.com/jquery-3.4.1.min.js'></script>
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <script src="https://x3dom.org/download/dev/x3dom-full.js"></script>
    <script src="https://raw.githack.com/jamesleesaunders/d3-x3d/master/dist/d3-x3d.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
    <script src='js/gridview.js'></script>
    <script src='js/gridview.3d.js'></script>
    <script src='js/info.division.js'></script>
    <script src='js/socket.handler.js'></script>
    <link rel="stylesheet" href="https://x3dom.org/download/dev/x3dom.css" />
    <link rel='stylesheet' href='https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css'
        integrity='sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB' crossorigin='anonymous'>
    <link rel='stylesheet' href='css/global.css'>
    <title>AIdel避障模擬系統</title>
</head>

<body onload="initGridView(5)">
    <main style='width: 100vw; height: 100vh;'>
        <ul id="navbar" class="nav nav-tabs">
            <li class="title">
                <h2><span>AIdel</span> 避障模擬系統</h2>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link active">避障模擬</a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link">即時影像</a>
            </li>
        </ul>
        <div id="simulate-div">
            <div class='input-group'>
                <input id='n-random' type='text' class='form-control' placeholder='請輸入生成數量' aria-label='請輸入生成數量'
                    aria-describedby='btnRandom'>
                <div class='input-group-append'>
                    <button id='btnGenerate' class='btn btn-outline-secondary simulate'>生成障礙物</button>
                    <button id='btnRandomGenerate' class='btn btn-outline-secondary simulate'>生成隨機數量障礙物</button>
                    <button id='btnSimulate' class='btn btn-outline-secondary simulate'>開始模擬</button>
                </div>
            </div>
            <div id='info-div'>
                <div class='card-header'></div>
                <div class='card-body scrollbar'></div>
            </div>
        </div>
        <div id="model-div" style="display: none;">
            <h4 class="warn-text">目前socket沒有連線</h4>
            <div id="model-3d"></div>
        </div>
    </main>
</body>
<script>
    let currentPage = 1;
    $('#navbar li.nav-item').click(function () {
        $('#navbar li.nav-item a').removeClass('active');
        $('main > div').hide();
        $(this).children('a').addClass('active');

        currentPage = $(this).index();
        $('main > ' +
            `div:nth-of-type(${currentPage})`).show();
    });
    $('#navbar ' + `li:nth-of-type(${currentPage})`).click();

    $('#n-random').keyup((e) => {
        e = e.target;

        if (!/^\d+$/.test(e.value)) {
            $(e).val(/^\d+/.exec($(e).val()));
        } else if (e.value <= 0 || e.value > upperLimit) {
            $(e).val('');
        }
        $('#btnGenerate').text(`生成${e.value + (e.value === '' ? '' : '個')}障礙物`);
        return false;
    });

    $('#btnGenerate').click((e) => {
        if (intervalID) return;
        isEnd = false;
        initGridView(Number($('#n-random').val()));
    });

    $('#btnRandomGenerate').click((e) => {
        if (intervalID) return;
        isEnd = false;
        initGridView(Math.floor(Math.random() * (upperLimit - 1)) + 1);
    });

    let count = 1;
    $('#btnSimulate').click(function () {
        if ($(this).text() === '開始模擬') {
            simulate(count++);
            $(this).text('取消模擬');
        } else {
            clearInterval(intervalID);
            intervalID = undefined;
            clearTimeout(timeoutID);
            timeoutID = undefined;
            initGridView(Number($('#n-random').val()) ||
                Math.floor(Math.random() * (upperLimit - 1)) + 1);
            $(this).text('開始模擬');
        }
    });
</script>

</html>